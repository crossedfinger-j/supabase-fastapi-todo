# Supabase & FastAPI Todo List

ì´ í”„ë¡œì íŠ¸ëŠ” [FastAPI](https://fastapi.tiangolo.com/)ë¥¼ ë°±ì—”ë“œë¡œ, [Supabase](https://supabase.io/)ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ ë° ì¸ì¦ ì†”ë£¨ì…˜ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” Todo List APIì…ë‹ˆë‹¤.

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

* ğŸš€ **FastAPI**: ë¹ ë¥´ê³  í˜„ëŒ€ì ì¸ íŒŒì´ì¬ ì›¹ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©
* ğŸ”’ **Supabase Auth**: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ ì²˜ë¦¬ (FastAPI ê²½ìœ )
* ğŸ”‘ **JWT ì¸ì¦**: `access_token`ì„ ì‚¬ìš©í•œ API ê²½ë¡œ ë³´í˜¸
* ğŸ“ **Full CRUD Operations**:
    * **Todos**: í•  ì¼ ëª©ë¡ (CRUD)
    * **Categories**: í•  ì¼ ë¶„ë¥˜ (CRUD)
    * **Priorities**: ìš°ì„ ìˆœìœ„ (Read)
* ğŸ” **Route Protection**: `Depends(get_current_user)`ë¥¼ í†µí•´ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³´í˜¸í•©ë‹ˆë‹¤.
* ğŸ›¡ï¸ **Row Level Security (RLS)**: Supabaseì˜ RLSë¥¼ í†µí•´ ì‚¬ìš©ìëŠ” **ì˜¤ì§ ìì‹ ì˜ ë°ì´í„°**ì—ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë§¤ìš° ì¤‘ìš”!)

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

* **Backend**: FastAPI, Uvicorn
* **Database**: Supabase (PostgreSQL)
* **Authentication**: Supabase Auth (JWT)
* **Language**: Python 3.x
* **Dependencies**: `supabase-py`, `pydantic`, `python-jose`, `passlib` ë“±

---

## ğŸ ì‹œì‘í•˜ê¸°

### 1. Supabase í”„ë¡œì íŠ¸ ì„¤ì •

1.  [Supabase](https://supabase.com/)ì— ë¡œê·¸ì¸í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
2.  **Authentication** > **Providers**ì—ì„œ **Email**ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. (ê¸°ë³¸ê°’)
3.  **SQL Editor**ì—ì„œ ì•„ë˜ì˜ **"í…Œì´ë¸” SQL ì˜ˆì‹œ"** ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ í…Œì´ë¸”ê³¼ RLS(ë³´ì•ˆ ì •ì±…)ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
4.  **Settings** > **API**ì—ì„œ **Project URL**ê³¼ **`service_role` key**ë¥¼ ë³µì‚¬í•´ ë‘¡ë‹ˆë‹¤. (FastAPI ë°±ì—”ë“œëŠ” ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•˜ë¯€ë¡œ `service_role` í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.)

### 2. í…Œì´ë¸” SQL ì˜ˆì‹œ

> ğŸ’¡ **ì¤‘ìš”:** ì•„ë˜ RLS(Row Level Security) ì •ì±…ì€ ì¸ì¦ëœ ì‚¬ìš©ìê°€ **ìì‹ ì˜ ë°ì´í„°ë§Œ** ë³´ê³  ìˆ˜ì •/ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ ë³´ì¥í•˜ëŠ” í•µì‹¬ ë³´ì•ˆ ì„¤ì •ì…ë‹ˆë‹¤.

```sql
-- 1. Priorities í…Œì´ë¸” ìƒì„± (ì´ ë°ì´í„°ëŠ” ëª¨ë“  ìœ ì €ê°€ ê³µìœ )
CREATE TABLE public.priorities (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL
);

-- Priorities í…Œì´ë¸”ì€ ì¸ì¦ëœ ì‚¬ìš©ìë¼ë©´ ëˆ„êµ¬ë‚˜ ì½ì„ ìˆ˜ ìˆë„ë¡ RLS ì„¤ì •
ALTER TABLE public.priorities ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow authenticated read access"
ON public.priorities
FOR SELECT
USING (auth.role() = 'authenticated');

-- Priorities ê¸°ë³¸ ë°ì´í„° ì‚½ì… (ì˜ˆì‹œ)
INSERT INTO public.priorities (id, name) VALUES (1, 'ë‚®ìŒ'), (2, 'ì¤‘ê°„'), (3, 'ë†’ìŒ');


-- 2. Categories í…Œì´ë¸” ìƒì„± (ì‚¬ìš©ìë³„ ë°ì´í„°)
CREATE TABLE public.categories (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  name TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Categories RLS ì„¤ì • (ìì‹ ì˜ ê²ƒë§Œ CRUD)
ALTER TABLE public.categories ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow individual access to own categories"
ON public.categories
FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);


-- 3. Todos í…Œì´ë¸” ìƒì„± (ì‚¬ìš©ìë³„ ë°ì´í„°)
CREATE TABLE public.todos (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  task TEXT NOT NULL,
  is_completed BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- ë‹¤ë¥¸ í…Œì´ë¸” ì°¸ì¡° (Foreign Keys)
  category_id UUID REFERENCES public.categories(id) ON DELETE SET NULL,
  priority_id BIGINT REFERENCES public.priorities(id) ON DELETE SET NULL
);

-- Todos RLS ì„¤ì • (ìì‹ ì˜ ê²ƒë§Œ CRUD)
ALTER TABLE public.todos ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow individual access to own todos"
ON public.todos
FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);
```

### 3. ë¡œì»¬ í™˜ê²½ ì„¤ì •

1.  **ë ˆí¬ì§€í† ë¦¬ í´ë¡ :**
    ```bash
    git clone [https://github.com/crossedfinger-j/supabase-fastapi-todo.git](https://github.com/crossedfinger-j/supabase-fastapi-todo.git)
    cd supabase-fastapi-todo
    ```

2.  **ê°€ìƒ í™˜ê²½ ìƒì„± ë° í™œì„±í™”:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Windows: venv\Scripts\activate
    ```

3.  **ì˜ì¡´ì„± ì„¤ì¹˜:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **.env íŒŒì¼ ìƒì„±:**
    í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  Supabase API ì„¤ì •ì—ì„œ ë³µì‚¬í•œ ê°’ë“¤ì„ ì…ë ¥í•©ë‹ˆë‹¤.
    ```ini
    SUPABASE_URL="[Your_Supabase_Project_URL]"
    SUPABASE_KEY="[Your_Supabase_Service_Role_Key]"
    ```

### 4. ì„œë²„ ì‹¤í–‰

```bash
uvicorn main:app --reload
```
ì„œë²„ê°€ ì‹¤í–‰ë˜ë©´ `http://127.0.0.1:8000/docs` ì—ì„œ API ë¬¸ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ” ì¸ì¦ ë°©ì‹ (Email/Password)

ë³¸ í”„ë¡œì íŠ¸ì˜ APIëŠ” FastAPI ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

1.  **íšŒì›ê°€ì…**: í´ë¼ì´ì–¸íŠ¸ê°€ `POST /signup`ìœ¼ë¡œ (email, password)ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. FastAPI ì„œë²„ëŠ” ì´ ì •ë³´ë¥¼ ë°›ì•„ `supabase.auth.sign_up`ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
2.  **ë¡œê·¸ì¸**: í´ë¼ì´ì–¸íŠ¸ê°€ `POST /login`ìœ¼ë¡œ (email, password)ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. FastAPI ì„œë²„ëŠ” `supabase.auth.sign_in_with_password`ë¥¼ í˜¸ì¶œí•˜ì—¬ **Access Token (JWT)**ì„ ë°›ìŠµë‹ˆë‹¤.
3.  **í† í° ë°˜í™˜**: FastAPIê°€ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ `Access Token`ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
4.  **API ìš”ì²­**: í´ë¼ì´ì–¸íŠ¸ëŠ” ì´í›„ ëª¨ë“  ë³´í˜¸ëœ API (Todos, Categories)ë¥¼ í˜¸ì¶œí•  ë•Œ ì´ Access Tokenì„ **HTTP Header**ì— í¬í•¨í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤.
    ```
    Authorization: Bearer [ACCESS_TOKEN]
    ```
5.  **ì„œë²„ ê²€ì¦**: FastAPIëŠ” `get_current_user` ì˜ì¡´ì„±ì„ í†µí•´ ì´ í† í°ì„ ê²€ì¦í•˜ê³ , ìœ íš¨í•œ ì‚¬ìš©ìì¸ì§€ í™•ì¸í•œ í›„ì—ì•¼ ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

## API ì—”ë“œí¬ì¸íŠ¸

### ğŸ‘¤ Auth (ì¸ì¦)
`tags=["Auth"]` (ë³„ë„ Prefix ì—†ìŒ)

* `POST /signup`: ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¡œ ìƒˆ ì‚¬ìš©ìë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
    * **Body**: `{ "email": "user@example.com", "password": "mypassword" }`
* `POST /login`: ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•˜ê³  Access Tokenì„ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.
    * **Body**: (Form Data) `username=user@example.com&password=mypassword`
    * **Response**: `{ "access_token": "...", "token_type": "bearer" }`

### âœ… Todos (í•  ì¼)
`prefix="/todos", tags=["Todos"]`

* `POST /`: ìƒˆ Todoë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ìë™ìœ¼ë¡œ `user_id`ê°€ ì¶”ê°€ë©ë‹ˆë‹¤)
* `GET /`: í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  Todoë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
* `GET /{todo_id}`: íŠ¹ì • Todoì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
* `PATCH /{todo_id}`: íŠ¹ì • Todoì˜ ì •ë³´ë¥¼ ì¼ë¶€ ìˆ˜ì •í•©ë‹ˆë‹¤. (ì˜ˆ: `task` ë˜ëŠ” `is_completed`)
* `DELETE /{todo_id}`: íŠ¹ì • Todoë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

### ğŸ—‚ï¸ Categories (ì¹´í…Œê³ ë¦¬)
`prefix="/categories", tags=["Categories"]`

* `POST /`: ìƒˆ ì¹´í…Œê³ ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ìë™ìœ¼ë¡œ `user_id`ê°€ ì¶”ê°€ë©ë‹ˆë‹¤)
* `GET /`: í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  ì¹´í…Œê³ ë¦¬ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
* `PATCH /{category_id}`: íŠ¹ì • ì¹´í…Œê³ ë¦¬ì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤. (ì˜ˆ: `name`)
* `DELETE /{category_id}`: íŠ¹ì • ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.

### â—ï¸ Priorities (ìš°ì„ ìˆœìœ„)
`prefix="/priorities", tags=["Priorities"]`

* `GET /`: ëª¨ë“  ì‚¬ìš©ìê°€ ê³µìœ í•˜ëŠ” ìš°ì„ ìˆœìœ„ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤. (ì˜ˆ: 'ë‚®ìŒ', 'ì¤‘ê°„', 'ë†’ìŒ')